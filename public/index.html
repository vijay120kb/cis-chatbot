<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>MasterCard CIS Assistant</title>
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;500;600;700&family=Syne:wght@400;600;700;800&display=swap" rel="stylesheet">
  <style>
    *,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
    :root{
      --gold:#f7a800;--gold-dim:#c4860a;
      --bg:#080c18;--bg2:#0d1322;--bg3:#131b2e;--bg4:#1a2540;
      --border:#1e2d45;--border2:#2d3a52;
      --text:#e2e8f0;--text-dim:#94a3b8;--text-muted:#4a5a72;
      --blue:#3b82f6;--green:#22c55e;--red:#ef4444;
    }
    body{background:var(--bg);color:var(--text);font-family:'JetBrains Mono',monospace;height:100vh;display:flex;flex-direction:column;overflow:hidden}

    /* HEADER */
    header{background:linear-gradient(135deg,#0b1530,#111e3d,#0b1530);border-bottom:1px solid var(--gold);padding:0 28px;height:64px;display:flex;align-items:center;gap:16px;flex-shrink:0;box-shadow:0 4px 32px rgba(247,168,0,.12)}
    .logo{width:42px;height:42px;background:linear-gradient(135deg,var(--gold),var(--gold-dim));border-radius:10px;display:flex;align-items:center;justify-content:center;font-family:'Syne',sans-serif;font-weight:800;font-size:20px;color:#080c18;box-shadow:0 4px 16px rgba(247,168,0,.35);flex-shrink:0}
    .header-text h1{font-family:'Syne',sans-serif;font-size:16px;font-weight:700;color:var(--gold);letter-spacing:2px}
    .header-text p{font-size:10px;color:var(--text-muted);letter-spacing:2px;margin-top:1px}
    .status{margin-left:auto;background:#0a3d1a;border:1px solid var(--green);border-radius:20px;padding:4px 14px;font-size:11px;color:var(--green);letter-spacing:1px;display:flex;align-items:center;gap:6px}
    .status-dot{width:7px;height:7px;background:var(--green);border-radius:50%;animation:blink 2s ease-in-out infinite}

    /* MESSAGES */
    #messages{flex:1;overflow-y:auto;padding:24px 28px;display:flex;flex-direction:column;gap:18px;scroll-behavior:smooth}
    #messages::-webkit-scrollbar{width:5px}
    #messages::-webkit-scrollbar-track{background:var(--bg)}
    #messages::-webkit-scrollbar-thumb{background:var(--border2);border-radius:4px}
    .row{display:flex;gap:12px;align-items:flex-start;animation:fadeUp .3s ease}
    .row.user{flex-direction:row-reverse}
    .avatar{width:34px;height:34px;min-width:34px;border-radius:9px;display:flex;align-items:center;justify-content:center;font-size:14px;font-weight:700;flex-shrink:0}
    .avatar.bot{background:linear-gradient(135deg,var(--gold),var(--gold-dim));color:#080c18;font-family:'Syne',sans-serif}
    .avatar.user{background:var(--bg4);border:1px solid var(--blue);color:var(--blue)}
    .bubble{max-width:72%;padding:14px 18px;font-size:13.5px;line-height:1.75;white-space:pre-wrap;word-break:break-word}
    .bubble.bot{background:linear-gradient(135deg,var(--bg3),var(--bg4));border:1px solid var(--border2);border-radius:4px 16px 16px 16px;box-shadow:0 4px 20px rgba(0,0,0,.3)}
    .bubble.user{background:linear-gradient(135deg,#1a3560,#172d52);border:1px solid var(--blue);border-radius:16px 4px 16px 16px;box-shadow:0 4px 20px rgba(59,130,246,.12)}

    /* TYPING */
    .typing{background:linear-gradient(135deg,var(--bg3),var(--bg4));border:1px solid var(--border2);border-radius:4px 16px 16px 16px;padding:14px 20px;display:flex;gap:6px;align-items:center}
    .dot{width:8px;height:8px;background:var(--gold);border-radius:50%;animation:bounce 1.2s ease-in-out infinite}
    .dot:nth-child(2){animation-delay:.2s}
    .dot:nth-child(3){animation-delay:.4s}

    /* SUGGESTIONS */
    #suggestions{padding:0 28px 16px;flex-shrink:0}
    .sug-label{font-size:10px;color:var(--text-muted);letter-spacing:2px;margin-bottom:10px}
    .sug-grid{display:flex;flex-wrap:wrap;gap:8px}
    .sug-btn{background:transparent;border:1px solid var(--border2);border-radius:8px;padding:8px 14px;color:var(--text-dim);font-size:12px;font-family:'JetBrains Mono',monospace;cursor:pointer;transition:all .2s;text-align:left}
    .sug-btn:hover{border-color:var(--gold);color:var(--gold);background:rgba(247,168,0,.05)}

    /* INPUT */
    footer{border-top:1px solid var(--border);background:var(--bg2);padding:16px 28px;flex-shrink:0;box-shadow:0 -4px 24px rgba(0,0,0,.3)}
    .input-row{display:flex;gap:12px;align-items:flex-end;max-width:860px;margin:0 auto}
    #input{flex:1;background:var(--bg3);border:1px solid var(--border2);border-radius:12px;padding:12px 16px;color:var(--text);font-size:13.5px;font-family:'JetBrains Mono',monospace;resize:none;outline:none;line-height:1.6;transition:border-color .2s;height:52px;min-height:52px;max-height:120px}
    #input::placeholder{color:var(--text-muted)}
    #input:focus{border-color:var(--gold)}
    #send{width:52px;height:52px;border-radius:12px;border:none;background:linear-gradient(135deg,var(--gold),var(--gold-dim));color:#080c18;font-size:22px;cursor:pointer;transition:all .2s;display:flex;align-items:center;justify-content:center;flex-shrink:0;box-shadow:0 4px 16px rgba(247,168,0,.35)}
    #send:hover{transform:scale(1.05);box-shadow:0 6px 20px rgba(247,168,0,.5)}
    #send:disabled{background:var(--border);color:var(--text-muted);box-shadow:none;cursor:not-allowed;transform:none}
    .hint{text-align:center;font-size:10px;color:var(--text-muted);letter-spacing:1px;margin-top:8px}

    /* ERROR */
    #err{display:none;background:#2d1010;border:1px solid var(--red);color:#fca5a5;padding:10px 20px;font-size:12px;text-align:center;flex-shrink:0}

    @keyframes fadeUp{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
    @keyframes bounce{0%,100%{opacity:.3;transform:scale(.8)}50%{opacity:1;transform:scale(1.2)}}
    @keyframes blink{0%,100%{opacity:1}50%{opacity:.4}}
  </style>
</head>
<body>
<header>
  <div class="logo">M</div>
  <div class="header-text">
    <h1>CIS ASSISTANT</h1>
    <p>MASTERCARD CUSTOMER INTERFACE SPECIFICATION Â· ISO 8583</p>
  </div>
  <div class="status"><div class="status-dot"></div>ONLINE</div>
</header>

<div id="err"></div>

<div id="messages">
  <div class="row bot">
    <div class="avatar bot">M</div>
    <div class="bubble bot">Hello! I am your MasterCard CIS Assistant ðŸ‘‹

I have deep knowledge of the Customer Interface Specification â€” covering ISO 8583 message types, Data Elements (DEs), authorization flows, reversal processing, Stand-In rules, and more.

Ask me anything about the spec and I'll give you precise, technical answers with page references where available.</div>
  </div>
</div>

<div id="suggestions">
  <div class="sug-label">SUGGESTED QUERIES</div>
  <div class="sug-grid" id="sug-grid"></div>
</div>

<footer>
  <div class="input-row">
    <textarea id="input" placeholder="Ask about DE fields, message types, authorization flows..." rows="1"></textarea>
    <button id="send" disabled>&#10148;</button>
  </div>
  <div class="hint">ENTER TO SEND Â· SHIFT+ENTER FOR NEW LINE</div>
</footer>

<script>
const SUGGESTIONS = [
  "Which DEs are mandatory in Authorization Request/0100?",
  "What is DE 39 Response Code and its values?",
  "Explain the Stand-In processing flow",
  "What is the difference between 0120 acquirer vs system-generated?",
  "What are mandatory fields in Reversal Request/0400?",
  "How does Chip PIN authorization work?",
  "What is DE 48 and its subelements?",
  "Explain the MTI structure in ISO 8583",
];

const msgsEl = document.getElementById('messages');
const inputEl = document.getElementById('input');
const sendEl  = document.getElementById('send');
const sugEl   = document.getElementById('suggestions');
const sugGrid = document.getElementById('sug-grid');
const errEl   = document.getElementById('err');

let history = [], loading = false;

SUGGESTIONS.forEach(q => {
  const b = document.createElement('button');
  b.className = 'sug-btn'; b.textContent = q;
  b.onclick = () => send(q);
  sugGrid.appendChild(b);
});

inputEl.addEventListener('input', () => {
  sendEl.disabled = !inputEl.value.trim() || loading;
  inputEl.style.height = 'auto';
  inputEl.style.height = Math.min(inputEl.scrollHeight, 120) + 'px';
});

inputEl.addEventListener('keydown', e => {
  if (e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); if (!sendEl.disabled) send(); }
});

sendEl.addEventListener('click', () => send());

function addMsg(role, text) {
  const row = document.createElement('div');
  row.className = 'row ' + role;
  const av = document.createElement('div');
  av.className = 'avatar ' + role;
  av.textContent = role === 'bot' ? 'M' : 'U';
  const bub = document.createElement('div');
  bub.className = 'bubble ' + role;
  bub.textContent = text;
  row.appendChild(av); row.appendChild(bub);
  msgsEl.appendChild(row);
  msgsEl.scrollTop = msgsEl.scrollHeight;
}

function showTyping() {
  const row = document.createElement('div');
  row.className = 'row bot'; row.id = 'typing';
  const av = document.createElement('div');
  av.className = 'avatar bot'; av.textContent = 'M';
  const t = document.createElement('div');
  t.className = 'typing';
  t.innerHTML = '<div class="dot"></div><div class="dot"></div><div class="dot"></div>';
  row.appendChild(av); row.appendChild(t);
  msgsEl.appendChild(row);
  msgsEl.scrollTop = msgsEl.scrollHeight;
}

function hideTyping() { document.getElementById('typing')?.remove(); }

function showErr(msg) {
  errEl.textContent = 'âš ï¸ ' + msg;
  errEl.style.display = 'block';
  setTimeout(() => errEl.style.display = 'none', 6000);
}

async function send(text) {
  const msg = text || inputEl.value.trim();
  if (!msg || loading) return;
  sugEl.style.display = 'none';
  inputEl.value = ''; inputEl.style.height = '52px';
  sendEl.disabled = true; loading = true;
  addMsg('user', msg);
  history.push({ role: 'user', content: msg });
  showTyping();
  try {
    const res = await fetch('/api/chat', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ messages: history })
    });
    const data = await res.json();
    hideTyping();
    if (data.error) { showErr(data.error); history.pop(); }
    else {
      addMsg('bot', data.response);
      history.push({ role: 'assistant', content: data.response });
    }
  } catch(e) {
    hideTyping(); showErr('Could not reach the server.'); history.pop();
  }
  loading = false; sendEl.disabled = !inputEl.value.trim(); inputEl.focus();
}
</script>
</body>
</html>
